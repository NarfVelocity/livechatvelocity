<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>LiveChat Account Context</title>

  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      padding: 12px;
      font-size: 14px;
    }

    #status {
      margin-bottom: 10px;
      font-weight: bold;
    }

    pre {
      background: #f5f5f5;
      padding: 10px;
      max-height: 500px;
      overflow: auto;
      white-space: pre-wrap;
      font-size: 12px;
      border-radius: 4px;
    }
  </style>
</head>

<body>

  <h3>LiveChat Account Context</h3>
  <div id="status">Loading SDK…</div>
  <pre id="output">(no data yet)</pre>

  <!-- IMPORTANT: module script -->
  <script type="module">
    import { createDetailsWidget } from "https://unpkg.com/@livechat/agent-app-sdk@latest/dist/index.esm.js";

    const statusEl = document.getElementById("status");
    const outputEl = document.getElementById("output");

    function log(label, value) {
      console.log(`[LiveChat Widget] ${label}`, value);
      outputEl.textContent =
        `${label}:\n${JSON.stringify(value, null, 2)}\n\n` +
        outputEl.textContent;
    }

    statusEl.textContent = "SDK loaded — initializing widget…";

    createDetailsWidget()
      .then(widget => {
        statusEl.textContent = "Widget initialized — waiting for data…";

        widget.on("customer", customer => {
          statusEl.textContent = "Customer profile received ✅";
          log("Customer", customer);
        });

        widget.on("chat", chat => {
          statusEl.textContent = "Chat context received ✅";
          log("Chat", chat);
        });

        // Debug: log everything
        widget.on("*", (event, payload) => {
          log(`Event: ${event}`, payload);
        });
      })
      .catch(err => {
        statusEl.textContent = "❌ Failed to initialize widget";
        console.error(err);
      });
  </script>

</body>
</html>
