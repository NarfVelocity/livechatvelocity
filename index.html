<script>
  const statusEl = document.getElementById("status");
  const outputEl = document.getElementById("output");

  if (!window.LiveChatAgentSDK) {
    statusEl.textContent = "❌ LiveChat SDK not available";
    throw new Error("Agent SDK not loaded");
  }

  const { createDetailsWidget } = window.LiveChatAgentSDK;

  createDetailsWidget().then(widget => {
    statusEl.textContent = "Connected to LiveChat ✅";

    // ---- 1️⃣ Pull INITIAL chat state ----
    widget.get("chat").then(chat => {
      if (chat) {
        outputEl.textContent =
          "CHAT (initial):\n" + JSON.stringify(chat, null, 2);
      }
    });

    widget.get("customer_profile").then(profile => {
      if (profile) {
        outputEl.textContent =
          "CUSTOMER PROFILE (initial):\n" + JSON.stringify(profile, null, 2);
      }
    });

    // ---- 2️⃣ Listen for UPDATES ----
    widget.on("chat", chat => {
      outputEl.textContent =
        "CHAT (update):\n" + JSON.stringify(chat, null, 2);
    });

    widget.on("customer_profile", profile => {
      outputEl.textContent =
        "CUSTOMER PROFILE (update):\n" + JSON.stringify(profile, null, 2);
    });
  });
</script>
