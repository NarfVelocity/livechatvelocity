<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>LiveChat Context Probe</title>
    <style>
      body {
        font-family: monospace;
        white-space: pre-wrap;
        margin: 0;
        padding: 12px;
      }
    </style>
  </head>
  <body>
    <pre id="out">Loading…</pre>

<script>
  const out = document.getElementById("out");

  function log(label, data) {
    out.textContent += `\n\n${label}:\n` + JSON.stringify(data, null, 2);
  }

  window.addEventListener("message", event => {
    if (event.origin !== "https://my.livechatinc.com") return;

    const msg = event.data;
    if (!msg || !msg["@@livechat/postmessenger"]) return;

    log("⬇️ received", msg);

    // When we see the first handshake, ask what APIs exist
    if (msg.type === "handshake") {
      const capabilitiesRequest = {
        "@@livechat/postmessenger": true,
        type: "request",
        owner: msg.owner,
        instance: msg.instance,
        request: {
          type: "get_capabilities"
        }
      };

      window.parent.postMessage(capabilitiesRequest, event.origin);
      log("⬆️ sent get_capabilities", capabilitiesRequest);
    }
  });
</script>

  </body>
</html>
